#+TITLE: QA Interactive Checklist (Release Candidate)
#+AUTHOR: Futon4 / Arxana team
#+OPTIONS: toc:nil num:t

* Purpose

This checklist captures interactive verification steps for the release
candidate. Run these with Futon1 available unless noted.

Coverage note: features called out in `./futon4/docs/RELEASE-CANDIDATE-1.1.md`
should have at least one QA check (or an explicit "not tested" entry) here.

* DONE 1. Setup
  
1. Start Futon1 (API on `http://localhost:8080`).
2. In Emacs, load Futon4: `M-x arxana-load`.
3. Set sync: `(setq futon4-base-url "http://localhost:8080/api/alpha")`
   and `(setq futon4-enable-sync t)`.

* DONE 2. Scholium targets (links-backed)

** 2.1 Docbook target
1. Open a docbook entry (e.g., `Quickstart`).
2. Select a region and run `M-x arxana-links-demo-create-scholium`.
3. Confirm it persists and reloads via:
   `M-: (arxana-links-load-scholia-for-doc "docbook://futon4/futon4-0cf1aad99fe8")`.
4. Confirm scholia render in place and in the side window via:
   `M-x arxana-docbook-show-scholia` (expect `*Arxana Scholia*` + highlights).

** 2.2 Code target
1. Open a source file (e.g., `dev/arxana-links.el`).
2. Select a region and run `M-x arxana-links-demo-create-scholium`.
3. Confirm it persists and reloads via:
   `M-: (arxana-links-load-scholia-for-doc "code://dev/arxana-links.el#arxana-links-make-scholium")`.

** 2.3 Scholium-on-scholium
1. Create a scholium on any target (docbook or code as above).
2. Capture its id from the returned plist using `M-:`:
   `M-: (plist-get (car (arxana-links-load-scholia-for-doc "docbook://futon4/futon4-0cf1aad99fe8")) :xt/id)`.
3. Create a reply scholium with `M-:` using the id as `:target-doc`, then persist:
   `M-: (arxana-links-persist-scholium (arxana-links-make-scholium :target-doc "<id>" :anchor (arxana-links-make-anchor (current-buffer) (region-beginning) (region-end)) :content "QA reply"))`.
4. Confirm the reply loads via:
   `M-: (arxana-links-load-scholia-for-doc "<id>")`.

* Region markup + overlays
- [X]

1. Select a region and run `M-x arxana-scholium-create-resilient`.
2. Verify an overlay appears with the annotation tooltip.
3. Edit the buffer to shift the region, then run `M-x arxana-scholium-verify-all`.
4. Confirm the overlay is re-anchored (anchored/fuzzy) or marked orphaned.

* Inclusion/transclusion UX
- [X]

1. Register two articles with `make-current-buffer-into-article`.
2. Run `M-x include-article` and verify inclusion markers.
3. Run `M-x transclude-article` and verify transclusion markers + overlays.
4. Use derivation preview commands (`M-x arxana-derivation-refresh`) to inspect
   inclusion/transclusion summaries.

* Docbook browsing + exports

** Basic operations

1. Open the Arxana Browser → Docs → futon4.
2. Verify the contents view and heading navigation.
3. Export to Org and PDF from the docbook contents view.

** Hyperlink quality

Assess hyperlink quality for docbook entries, not content correctness.

1. In `arxana://view/docbook-contents`, press `y` on several headings.
   Confirm the URI is a `docbook://<book>/<doc-id>` that matches the book.
2. Press `Y` and confirm it yields the same logical target as `y`
   (or an explicit error if the higher-fidelity path is unavailable).
3. Open a docbook entry and use `RET` on any inline link/URI.
   Confirm it opens the intended target without creating a new frame.
4. In `*Arxana Docbook*`, hover/cycle links and confirm the target buffer
   is highlighted/selected consistently (no orphaned link state).
5. In `*Arxana Code Docs*`, verify that symbol mentions in the preview
   highlight as you move point within the corresponding defun.
   Confirm link activation opens the right file/symbol.
6. Cross-links: from a docbook entry that references a code file or symbol,
   follow the link into the code buffer and confirm the paired docs view
   shows the originating docbook entry highlighted.

** Persisted hyperlink types

Verify each supported persisted hyperlink type both works and is documented.

1. Strategy (arxana/link-strategy): create/load via
   `M-x arxana-links-demo-create-strategy`, then confirm it is listed in
   `M-x arxana-links-status` and referenced in docs.
2. Voiced link (arxana/voiced-link): promote a link with
   `M-x arxana-links-demo-promote-link`, confirm it persists and renders.
3. Surface form (arxana/surface-form): capture via
   `M-x arxana-links-capture-surface-form`, confirm it persists and resolves.
4. Scholium (arxana/scholium): covered in section 2; confirm it is documented.
5. Embedding cache (arxana/embedding-cache): if enabled, confirm it persists and
   is documented; if not enabled, note as explicitly unavailable.

* Hard mode section

** 1. Negative / failure paths

Right now everything assumes the happy path.

Add one explicit failure check per subsystem:

Storage unreachable

Stop Futon1.

Attempt arxana-links-demo-create-scholium.

Confirm:

User-visible error

No partial overlay left behind

No buffer-local corruption

Malformed target-doc

Manually pass an invalid docbook:// or code:// URI to arxana-links-load-scholia-for-doc.

Confirm empty result + warning, not hard error.

** 2. Identity stability checks

You test reload, but not identity invariants.

Add:

Create a scholium.

Reload it twice.

Confirm:

:xt/id remains stable

Anchor hash (or equivalent) remains stable unless buffer content changes

This guards against accidental “new entity per load” regressions.

** 3. Cross-buffer anchoring

You currently test re-anchoring only within one buffer.

Add:

Create a scholium on a code region.

Kill the buffer.

Reopen the file from disk.

Run arxana-scholium-verify-all.

Confirm:

Overlay reappears

Anchor classification is correct (exact / fuzzy / orphaned)

This matches real restart workflows better than in-buffer edits.

** 4. Inclusion / transclusion ordering edge case

Inclusion logic often breaks under nesting.

Add one step:

Include Article A into B.

Transclude Article B into C.

Refresh derivation preview.

Confirm:

Order is deterministic

No duplicate scholia appear

No infinite recursion markers

** 5. Export fidelity spot-check

Exports are currently only “does it run”.

Add:

Export to Org.

Inspect:

Scholium content present exactly once

Anchors represented (IDs or comments)

Export to PDF.

Confirm:

Scholium text rendered (even if flattened)

No raw XTDB IDs leak visibly unless intended

Optional structural refinement

If you want to tighten this further without expanding scope:

Add a final section: “Restart invariants”

Restart Emacs

Restart Futon1

Reload a known docbook

Confirm scholia + overlays rehydrate correctly

That gives you a clean “cold start” gate before calling something a release candidate.
