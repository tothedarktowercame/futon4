#+TITLE: Arxana Reanimation Plan
#+AUTHOR: Futon4 / Arxana team
#+OPTIONS: toc:nil num:t

* Purpose

This living specification tracks the work required to bring the classic
Arxana Emacs client back into a fully functional state while targeting the
Futon1 EAV backend.  Each milestone links source material (Org chapters,
Elisp modules, docs) to concrete validation steps so we can prove round-trip
behavior at every stage.

* Workflow loop

1. Load the dev harness (`M-x arxana-load` or `dev/run-tests.sh`).
2. Run the ERT smoke suite to verify the harness still loads.
3. Exercise the feature under development inside Emacs and via Futon curl
   checks, capturing the commands we expect contributors to run.
4. Update this file and the corresponding XTDB doc entry with new tasks,
   status, and references.

* Milestone tracker

** M0 — Harness & Spec [3/3]
- [X] Record the reanimation scope and workflow in this document.
- [X] Provide a repeatable bootstrap harness (interactive + batch).
- [X] Seed a minimal ERT suite that gatekeeps the harness.

** M1 — Storage Bridge Hardening [5/5]
- [X] Audit Futon sync funcs (`futon4-*`) and document supported ops (`docs/storage-bridge.org`).
- [X] Wrap backend calls with user-facing commands (`arxana-store-*`).
- [X] Capture curl verification steps per endpoint (see storage bridge doc + README).
- [X] Add ERT/Elisp fakes for entity + relation flow (`test/arxana-store-test.el`).
- [X] Ensure Emacs gracefully handles Futon downtime (error plists + log messages).

** M2 — Article Lifecycle [5/5]
- [X] Restore buffer/file → article flows with canonical ids (bootstrap + path cache).
- [X] Rebuild metadata scholium syncing for labels/backlinks (hooks feed Futon props).
- [X] Confirm deletes/updates propagate to Futon history (`status` updates + history docs).
- [X] Provide regression fixtures for article round trips (ERT store/article tests).
- [X] Document workflows in `README.md` (editing, syncing, verifying).

** M3 — Scholia & Relations [4/4]
- [X] Reinstate scholium authoring minor mode + Futon relation mirroring.
- [X] Surface `/ego`, `/cooccur`, `/tail` data inside Emacs buffers.
- [X] Add automated checks for scholium adjacency.
- [X] Expand docs with relation troubleshooting steps.

** M4 — Browsing & Rendering [5/5]
- [X] Re-enable Part VI browsing modes (local, catalog, temporal, linear).
- [X] Tie rendering buffers to Futon ids for refresh + provenance.
- [X] Build UI affordances for inclusion/derivation previews.
- [X] Validate expanded/collapsed views with backend data.
- [X] Add narrative examples demonstrating the flows.

** M5 — Workflow plumbing [3/4]
- [X] Map inclusion/derivation/provenance events to multi-end Futon edges.
- [X] Connect save/restore to XTDB snapshots instead of legacy stores.
- [X] Create import/export shims for modern doc formats.
- [X] Produce migration notes for historical datasets. (Closed: rewrite supersedes migration; legacy audit deferred.)

** M5A — Inclusion/Transclusion UX [3/3]
- [X] Visually differentiate included vs. transcluded regions in the main article buffer.
- [X] Provide toggle commands to highlight each derivative type independently.
- [X] Document the visual affordances and add a regression test covering both styles.

** M6 — QA & Release Prep [3/4]
- [X] Grow the ERT suite (unit, integration, CLI smoke).
  - Added Futon1-backed `arxana-links` persistence + demo coverage (availability-gated).
- [X] Document test instructions + CI hooks.
- [X] Provide contributor guide (coding style, doc sync, testing).

** M6A — Cleanup & Final Decisions [5/5]
- [X] Confirm the Xanadu-link scope (transclusion, versioned anchors, provenance).
  - Documented in `docs/docbook/futon4/futon4-00eed2b34c80.org`.
- [X] Decide the persistence model (XTDB-only vs local cache and sync rules).
  - XTDB-only persistence with link strategies/anchors + scholia stored via Futon1.
  - Storage semantics captured in `docs/storage-bridge.org` and docbook links section.
- [X] Lock the authoring workflow (region-based, scholium-first, or hybrid).
  - Scholium-first, region-based workflow documented in `docs/docbook/futon4/futon4-00eed2b34c80.org`.
- [X] Define UI expectations (main-buffer overlays, relation browser, docbook).
  - Docbook outline now separates user docs vs developer docs; browsing/links live under user.
- [X] Record any migration or compatibility callouts for legacy links.
  - Rewrite supersedes migration; legacy audit deferred post-Prototype-1.

** M7 — Docbook + Manual Export [5/5]
- [X] Verify docbook browser health (filesystem + XTDB sources) and list any blockers.
  - Filesystem: `docs/docbook/futon4` exists; toc snapshot is local.
  - XTDB: `/docs/futon4/toc` responds via Futon1 API when sync is enabled.
  - Blocker: outline changes in toc.json are not yet synced to XTDB headings.
- [X] Finish XTDB docbook ingest pipeline (contract → API → storage).
  - Contract + API live in Futon1; Futon4 relies on `/docs/:book/toc`,
    `/docs/:book/contents`, `/docs/:book/heading/:doc-id`, and `/docs/:book/entry`.
  - Validation is handled server-side by the docbook model invariants.
- [X] Define canonical export targets (Markdown/HTML/PDF) for non-Emacs readers.
  - Canonical targets: Org (primary) + PDF (compiled).
- [X] Build an export command to render manuals from XTDB (or a snapshot mirror).
  - `arxana-docbook-export-org-book`, `arxana-docbook-export-pdf-book`.
- [X] Document the export workflow + prerequisites in README and XTDB docs.
  - Docbook export instructions now live in `docs/docbook/futon4/futon4-1cf7e8683779.org`.

** M8 — Legacy dataset migration notes [2/2]
- [X] Define scope for “historical datasets” (which backends and export formats). (Closed: rewrite supersedes migration; consider post-Prototype-1 legacy audit.)
- [X] Produce migration notes or close the milestone if no longer relevant. (Closed: rewrite supersedes migration; consider post-Prototype-1 legacy audit.)

** Doc sync tracker [3/7]
- [X] Storage + snapshots (`arxana-store`, `arxana-saving`).
- [X] Browsing & relations (`arxana-browse`, `arxana-relations`, `arxana-xtdb-browse`).
- [X] Links + strategies (`arxana-links`, `docs/docbook/futon4/futon4-bced1ef693fb.org`).
- [X] Import/export helpers (`arxana-import`, `arxana-articles-export`).
  - Import docs: `docs/docbook/futon4/futon4-994ec7cb244a.org`.
  - Export docs: `docs/docbook/futon4/futon4-9ef2983bf062.org`.
  - Tests: `test/arxana-import-test.el`, `test/arxana-export-test.el`.
- [X] Pattern workflows (`arxana-patterns` + ingest shims).
  - Overview + safety guarantees: `docs/docbook/futon4/futon4-a36b4f60c62b.org`.
  - Ingestion details: `docs/docbook/futon4/futon4-f1c8c427256a.org`.
  - Editing workflow: `docs/docbook/futon4/futon4-7bde4c62d6e8.org`.
- [X] Article/scholium/inclusion stack (`arxana-article`, `arxana-scholium`, `arxana-inclusion`).
  - Added integration tests for scholia targeting docbook, code, and scholia (`test/arxana-links-test.el`).
  - Added overlay/verification tests for resilient scholia (`test/arxana-scholium-test.el`).
  - Interactive QA checklist: `docs/qa-interactive-checklist.org`.
- [ ] QA/compat/test support modules.

  Each check means the module has a matching XTDB doc entry and any optional
  filesystem snapshot is aligned with the current `dev/` behavior. If a snapshot
  exists, record the doc id and snapshot location in `dev/docs-backlog.org`.

** M9 — Release tag [0/1]
- [ ] Tag a “revived” release with reproducible steps.

* Artifacts

- Harness + bootstrap: `dev/bootstrap.el`
- Tests: `test/`
- Docs: this plan and future how-tos.

Update this plan whenever a milestone progresses; keep the checklist honest.
